import{_,c as a,a as e,b as c,t as l,n as u,w as g,d as f,v as y,F as v,r as h,u as m,e as d,o as i,f as p}from"./index-AvumaKeu.js";const j={name:"ZonaClienteModal",data(){return{usuario:{nombre:"",correo:"",nuevaContrasena:""},catalogo:[{ID_recompensa:1,Descuento_aplicado:20,Puntos_necesarios:10},{ID_recompensa:2,Descuento_aplicado:100,Puntos_necesarios:100}],modalAbierto:null,puntos:null,reservas:[],userId:localStorage.getItem("user_id"),mensajePerfil:"",tipoMensajePerfil:"",favoritos:[],mensajeFavoritos:"",recompensas:[],mensajeRecompensas:""}},methods:{abrirModal(o){this.modalAbierto=o,o==="perfil"&&this.obtenerPerfil(),o==="puntos"?this.obtenerPuntos():o==="reservas"&&this.obtenerReservas(),o==="favoritos"&&this.cargarFavoritos(),o==="puntos"&&(this.obtenerPuntos(),this.obtenerCatalogo())},cerrarModal(){this.modalAbierto=null},async cerrarSesion(){try{await api.post("/logout",{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})}catch{console.warn("Error cerrando sesión (token puede haber expirado).")}localStorage.removeItem("usuario"),localStorage.removeItem("token"),m.value=null,this.$router.push("/")},async obtenerPuntos(){try{const o=await d.get(`http://localhost:8000/api/usuarios/${this.userId}`);this.puntos=o.data.puntos||0;const s=await d.get(`http://localhost:8000/api/usuarios/${this.userId}/recompensas`);this.recompensas=Array.isArray(s.data)?s.data:[]}catch(o){console.error("Error al obtener puntos o recompensas:",o),this.puntos=0,this.recompensas=[]}},async obtenerReservas(){try{const o=await d.get(`http://localhost:8000/api/mis-reservas/${this.userId}`);this.reservas=Array.isArray(o.data)?o.data:[]}catch(o){console.error("Error al obtener reservas:",o),this.reservas=[]}},async obtenerPerfil(){try{const o=await d.get(`http://localhost:8000/api/usuarios/${this.userId}`);this.usuario.nombre=o.data.Nombre,this.usuario.correo=o.data.Correo}catch(o){console.error("Error al obtener perfil:",o)}},async actualizarPerfil(){try{const o={Nombre:this.usuario.nombre,Correo:this.usuario.correo};this.nuevaContrasena.trim()!==""&&(o.password=this.nuevaContrasena),await d.put(`http://localhost:8000/api/usuarios/${this.userId}`,o),this.mensajePerfil="Perfil actualizado correctamente.",this.tipoMensajePerfil="success",this.cerrarModal()}catch(o){console.error("Error al actualizar perfil:",o),this.mensajePerfil="Hubo un error al actualizar el perfil.",this.tipoMensajePerfil="danger"}finally{setTimeout(()=>{this.mensajePerfil=""},4e3)}},async cargarFavoritos(){try{const o=await d.get(`http://localhost:8000/api/favoritos?usuario=${this.userId}`);this.favoritos=Array.isArray(o.data)?o.data:[]}catch(o){console.error("Error al obtener favoritos:",o),this.favoritos=[],this.mensajeFavoritos="Error al cargar favoritos."}},toggleAccesibilidad(){document.body.classList.toggle("modo-accesible")},eliminarFavorito(o){d.delete(`http://localhost:8000/api/favoritos/${o}`).then(()=>{this.favoritos=this.favoritos.filter(s=>s.ID_favorito!==o)}).catch(()=>{this.mensajeFavoritos="No se pudo eliminar el favorito."})},async canjearRecompensa(){try{if(this.puntos<300){alert("Necesitas al menos 300 puntos para canjear una recompensa.");return}const o=await d.post("http://localhost:8000/api/recompensas",{ID_usuario:this.userId,Puntos_necesarios:300,Descuento_aplicado:20});alert("¡Has canjeado una recompensa con éxito!"),this.obtenerPuntos()}catch(o){alert("Error al canjear la recompensa."),console.error(o)}},async obtenerCatalogo(){try{const o=await d.get("http://localhost:8000/api/recompensas");this.catalogo=Array.isArray(o.data)?o.data:[]}catch(o){console.error("Error al obtener catálogo:",o),this.catalogo=[]}},async canjearRecompensaDesdeCatalogo(o){try{await d.put(`http://localhost:8000/api/recompensas/${o}/canjear`),await this.obtenerPuntos(),await this.obtenerCatalogo()}catch(s){this.mensajeRecompensas="Error al canjear recompensa.",console.error(s)}},canjearVisualmente(o){if(this.puntos<o.Puntos_necesarios){this.mensajeRecompensas="No tienes puntos suficientes.";return}this.puntos-=o.Puntos_necesarios,m.value&&(m.value.puntos=this.puntos,m.value.descuentoActivo=o.Descuento_aplicado,localStorage.setItem("usuario",JSON.stringify(m.value))),this.recompensas.push({ID_recompensa:Date.now(),Descripcion:o.Descripcion||`Descuento de ${o.Descuento_aplicado}€`,Descuento_aplicado:o.Descuento_aplicado,Puntos_necesarios:o.Puntos_necesarios}),this.catalogo=this.catalogo.filter(s=>s.ID_recompensa!==o.ID_recompensa)}}},k={class:"container mt-5"},C={class:"d-flex justify-content-end mb-3"},x={key:0,class:"mb-4"},D={class:"row g-4"},P={class:"col-md-8"},w={class:"card h-100 text-center"},I={class:"card-body d-flex flex-column justify-content-center"},A={class:"col-md-4"},M={class:"card h-100 text-center"},N={class:"card-body d-flex flex-column justify-content-center"},E={class:"col-md-4"},F={class:"card h-100 text-center"},S={class:"card-body d-flex flex-column justify-content-center"},V={class:"col-md-4"},R={class:"card h-100 text-center"},z={class:"card-body d-flex flex-column justify-content-center"},H={class:"text-end mt-4"},B={class:"modal-dialog modal-dialog-centered"},T={class:"modal-content"},U={class:"modal-header"},Z={class:"modal-body"},q={class:"mb-3"},L={class:"mb-3"},G={class:"mb-3"},J={class:"modal-dialog modal-dialog-centered modal-lg"},O={class:"modal-content"},Q={class:"modal-header"},K={class:"modal-body"},W={key:0,class:"alert alert-info"},X={key:1,class:"text-center text-muted"},Y={key:2,class:"list-group"},$={class:"mb-0"},ss={key:0},es={key:1},os=["onClick"],ts={class:"modal-dialog modal-dialog-centered"},rs={class:"modal-content"},as={class:"modal-header"},is={class:"modal-body"},ns={class:"fw-bold"},ls={key:0},ds={class:"list-group"},cs={key:1,class:"mt-4"},us={class:"list-group"},ms=["disabled","onClick"],ps={key:2,class:"text-muted text-center mt-3"},bs={class:"modal-dialog modal-dialog-centered"},vs={class:"modal-content"},hs={class:"modal-header"},fs={class:"modal-body"},ys={class:"list-group"},_s={class:"text-capitalize"};function gs(o,s,js,ks,r,n){return i(),a("div",k,[s[33]||(s[33]=e("h2",{class:"text-center mb-4"},"Zona Cliente",-1)),e("div",C,[e("button",{onClick:s[0]||(s[0]=(...t)=>n.toggleAccesibilidad&&n.toggleAccesibilidad(...t)),class:"btn btn-outline-light bg-dark"}," ♿ Accesibilidad visual ")]),r.mensajePerfil?(i(),a("div",x,[e("div",{class:u(["alert",r.tipoMensajePerfil==="success"?"alert-success":"alert-danger"]),role:"alert"},l(r.mensajePerfil),3)])):c("",!0),e("div",D,[e("div",P,[e("div",w,[e("div",I,[s[14]||(s[14]=e("h5",{class:"card-title"},"Ver y editar perfil",-1)),e("button",{class:"btn btn-primary mt-3",onClick:s[1]||(s[1]=t=>n.abrirModal("perfil"))},"Acceder")])])]),e("div",A,[e("div",M,[e("div",N,[s[15]||(s[15]=e("h5",{class:"card-title"},"Favoritos",-1)),e("button",{class:"btn btn-primary mt-3",onClick:s[2]||(s[2]=t=>n.abrirModal("favoritos"))},"Ver favoritos")])])]),e("div",E,[e("div",F,[e("div",S,[s[16]||(s[16]=e("h5",{class:"card-title"},"Canjear puntos",-1)),e("button",{class:"btn btn-success mt-3",onClick:s[3]||(s[3]=t=>n.abrirModal("puntos"))},"Canjear")])])]),e("div",V,[e("div",R,[e("div",z,[s[17]||(s[17]=e("h5",{class:"card-title"},"Historial de reservas",-1)),e("button",{class:"btn btn-secondary mt-3",onClick:s[4]||(s[4]=t=>n.abrirModal("reservas"))},"Ver historial")])])])]),e("div",H,[e("button",{class:"btn btn-danger",onClick:s[5]||(s[5]=(...t)=>n.cerrarSesion&&n.cerrarSesion(...t))},"Cerrar sesión")]),r.modalAbierto==="perfil"?(i(),a("div",{key:1,class:u(["modal fade",{show:r.modalAbierto==="perfil"}]),tabindex:"-1",style:{display:"block"}},[e("div",B,[e("div",T,[e("div",U,[s[18]||(s[18]=e("h5",{class:"modal-title"},"Perfil del Usuario",-1)),e("button",{type:"button",class:"btn-close",onClick:s[6]||(s[6]=(...t)=>n.cerrarModal&&n.cerrarModal(...t))})]),e("div",Z,[e("form",{onSubmit:s[10]||(s[10]=g((...t)=>n.actualizarPerfil&&n.actualizarPerfil(...t),["prevent"]))},[e("div",q,[s[19]||(s[19]=e("label",{for:"nombre",class:"form-label"},"Nombre",-1)),f(e("input",{type:"text",id:"nombre","onUpdate:modelValue":s[7]||(s[7]=t=>r.usuario.nombre=t),class:"form-control",required:""},null,512),[[y,r.usuario.nombre]])]),e("div",L,[s[20]||(s[20]=e("label",{for:"email",class:"form-label"},"Correo",-1)),f(e("input",{type:"email",id:"email","onUpdate:modelValue":s[8]||(s[8]=t=>r.usuario.correo=t),class:"form-control",required:""},null,512),[[y,r.usuario.correo]])]),e("div",G,[s[21]||(s[21]=e("label",{for:"nuevaContrasena",class:"form-label"},"Nueva contraseña",-1)),f(e("input",{type:"password",id:"nuevaContrasena","onUpdate:modelValue":s[9]||(s[9]=t=>o.nuevaContrasena=t),class:"form-control"},null,512),[[y,o.nuevaContrasena]])]),s[22]||(s[22]=e("button",{type:"submit",class:"btn btn-success"},"Guardar cambios",-1))],32)])])])],2)):c("",!0),r.modalAbierto==="favoritos"?(i(),a("div",{key:2,class:u(["modal fade",{show:r.modalAbierto==="favoritos"}]),tabindex:"-1",style:{display:"block"}},[e("div",J,[e("div",O,[e("div",Q,[s[23]||(s[23]=e("h5",{class:"modal-title"},"Mis destinos favoritos",-1)),e("button",{type:"button",class:"btn-close",onClick:s[11]||(s[11]=(...t)=>n.cerrarModal&&n.cerrarModal(...t))})]),e("div",K,[r.mensajeFavoritos?(i(),a("div",W,l(r.mensajeFavoritos),1)):c("",!0),r.favoritos.length===0&&!r.mensajeFavoritos?(i(),a("div",X," No tienes destinos marcados como favoritos. ")):(i(),a("ul",Y,[(i(!0),a(v,null,h(r.favoritos,t=>(i(),a("li",{key:t.ID_favorito,class:"list-group-item d-flex justify-content-between align-items-center"},[e("div",null,[e("h6",$,[t.destino?(i(),a("span",ss,l(t.destino.Nombre),1)):(i(),a("span",es,"Destino ID: "+l(t.ID_destino),1))])]),e("button",{class:"btn btn-sm btn-danger",onClick:b=>n.eliminarFavorito(t.ID_favorito)}," Quitar ",8,os)]))),128))]))])])])],2)):c("",!0),r.modalAbierto==="puntos"?(i(),a("div",{key:3,class:u(["modal fade",{show:r.modalAbierto==="puntos"}]),tabindex:"-1",style:{display:"block"}},[e("div",ts,[e("div",rs,[e("div",as,[s[24]||(s[24]=e("h5",{class:"modal-title"},"Canjear puntos",-1)),e("button",{type:"button",class:"btn-close",onClick:s[12]||(s[12]=(...t)=>n.cerrarModal&&n.cerrarModal(...t))})]),e("div",is,[e("p",ns,"Tienes actualmente "+l(r.puntos)+" puntos.",1),r.recompensas.length?(i(),a("div",ls,[s[28]||(s[28]=e("h6",{class:"mt-3"},"Historial de recompensas canjeadas:",-1)),e("ul",ds,[(i(!0),a(v,null,h(r.recompensas,t=>(i(),a("li",{key:t.ID_recompensa,class:"list-group-item"},[s[25]||(s[25]=p(" Descuento de ")),e("strong",null,l(t.Descuento_aplicado)+"€",1),s[26]||(s[26]=p(" - Canjeado por ")),e("strong",null,l(t.Puntos_necesarios),1),s[27]||(s[27]=p(" puntos "))]))),128))])])):c("",!0),r.catalogo.length?(i(),a("div",cs,[s[29]||(s[29]=e("h6",null,"Catálogo de recompensas disponibles:",-1)),e("ul",us,[(i(!0),a(v,null,h(r.catalogo,t=>(i(),a("li",{key:t.ID_recompensa,class:"list-group-item d-flex justify-content-between align-items-center"},[e("span",null,l(t.Descripcion)+" ("+l(t.Puntos_necesarios)+" puntos)",1),e("button",{class:"btn btn-sm btn-warning",disabled:r.puntos<t.Puntos_necesarios,onClick:b=>n.canjearVisualmente(t)}," Canjear ",8,ms)]))),128))])])):(i(),a("div",ps," No hay recompensas disponibles en este momento. "))])])])],2)):c("",!0),r.modalAbierto==="reservas"?(i(),a("div",{key:4,class:u(["modal fade",{show:r.modalAbierto==="reservas"}]),tabindex:"-1",style:{display:"block"}},[e("div",bs,[e("div",vs,[e("div",hs,[s[30]||(s[30]=e("h5",{class:"modal-title"},"Historial de reservas",-1)),e("button",{type:"button",class:"btn-close",onClick:s[13]||(s[13]=(...t)=>n.cerrarModal&&n.cerrarModal(...t))})]),e("div",fs,[e("ul",ys,[(i(!0),a(v,null,h(r.reservas,t=>{var b;return i(),a("li",{class:"list-group-item",key:t.ID_reserva},[s[31]||(s[31]=p(" Reserva en ")),e("strong",null,l(((b=t.destino)==null?void 0:b.Nombre)||"Destino desconocido"),1),s[32]||(s[32]=p(" - Estado: ")),e("span",_s,l(t.Estado),1)])}),128))])])])])],2)):c("",!0)])}const xs=_(j,[["render",gs],["__scopeId","data-v-7e7ca8bd"]]);export{xs as default};
